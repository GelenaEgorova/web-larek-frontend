# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении


Карточка товара
```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number
}
```
Массив карточек на главной странице
```
export interface IProductsList {
    products: IProduct[];
    preview: string | null;
}
```

Информация о товарах в корзине
```
export type IBasket = Pick<IProduct, 'title' | 'price'>;
```

Форма ввода данных об адресе и способе доставки
```
export interface IOrder {
    payment: string;
    adress: string;
}
```

Форма ввода контактных данных покупателя
```

export interface IBuyerInfo {
    email: string;
    phone: string;
}
```

Проверка валидации форм

```
export interface IOrderData {
    CheckValidation(data: Record<keyof IOrder, string>): boolean;
}

export interface IBuyerInfoData {
    CheckValidation(data: Record<keyof IBuyerInfo, string>): boolean;
}

```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - установка обработчика на событие
- `off` - снятие обработчика с события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
- `onAll` - установка слушашателя на все события
- `offAll` - сброс всех обработчиков с события

### Слой данных

#### Класс Product
Класс отвечает за хранение и логику работы с данными карточки продукта\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

    id: string; - уникальный номер продукта
    description - описание продукта
    image - изображение продукта
    title - наименование продукта
    category - категория, к которой относится товар
    price - цена

#### Класс Page

Реализует отобржение корзины с количеством товара в ней и массив карточек товаров

Поля класса:
- counter: number, - счетчик элементов в корзине
- catalog: HTMLElement[] - массив карточек товаров

#### Класс Modal
Реализует модальное окно, содержит методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по клику на оверлей или крестик.

Поля класса:
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей информацию о выбранных для оформления товарах. При сабмите инициирует событие подтверждения данных и переходу к оформлению заказа.

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- list: HTMLElement[] - коллекция всех выбранных товаров
- total: string; - сумма для оплаты

Методы: 
- deleteCard(cardId: string): void  - удаление товара из корзины


#### Класс ModalWithAdress
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей поле ввода адреса и способов оплаты заказа. При сабмите инициирует событие подтверждения данных для отправки и оплаты заказа. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- PaymentButton: HTMLButtonElement - кнопка выбора способа оплаты
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекции всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы: 
- setError(data: {field: string, value: string, validInformation: string}): void - принимает объект с данными для отображения или скрытия ошибок под полями ввода
- showInputError(fiel: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError(fiel: string): void - скрывает текст ошибки под указанным полем ввода
- clearModal() - очищает поля формы и сбрасывает состояния кнопок при сабмите.

#### Класс ModalWithContacts
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей поля ввода телефона и эмейла. При сабмите инициирует событие подтверждения данных и переход на окно с уведомлением об успешном оформлении заказа.

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекции всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы: 
- setError(data: {field: string, value: string, validInformation: string}): void - принимает объект с данными для отображения или скрытия ошибок под полями ввода
- showInputError(fiel: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError(fiel: string): void - скрывает текст ошибки под указанным полем ввода
- clearModal() - очищает поля формы и сбрасывает состояния кнопок при сабмите.

#### Класс SuccessfulOrder
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей сообщение об успешном оформлении заказа, в которое передаётся полная стоимость корзины. 


### Взаимодействие компнонетов
Взаимодействие осуществляется за счет событий, генерируемых с помощью броекера событий и их обработчиков. 

Список событий, которые могут генерироваться в системе

-`products:changed` - изменение массива карточек товаров.
- `product:selected` - при клике на товар всплывает модальное окно с подробной информацией о товаре и возможностью добавления товара в корзину.
- `basket:open`- открытие модального окна с содержимым корзины.
- `basket:toggleItem` - при клике в модальном окне товара на кнопку "добавить в корзину" происходит добавление товара.
- `basket:deleteItem` - при клике на кнопку удаления товара в корзине.
- `basket:order` - оформление заказа из корзины.
- `payment:change` - выбор способа оплаты.
- `address:input` - ввод адреса доставки заказа.
- `order:submit` - подтверждение данных для оплаты и доставки.
- `email:input` - ввод почтового адреса клиента.
- `phone:input` - ввод телефона клиента.
- `contacts:submit` - подтверждение контактных данных.
- `order:complete` - при открытии окна успешной оплаты.
- `order:validation` - событие, сообщающее о необходимости валидации формы с вводом адреса и способа оплаты.
- `contacts::validation` - событие, сообщающее о необходимости валидации формы с контактными данными. 
